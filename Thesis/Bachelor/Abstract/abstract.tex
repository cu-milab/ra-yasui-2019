\documentclass{jsarticle}
\usepackage{abst, epsf,graphicx, tabularx, ascmac}
%\usepackage{comment}

\newcommand{\bd}[1]{\mbox{\boldmath$#1$}}
\newcommand{\mysubsec}[1]{\noindent {\bf #1} \ \ }
\newcommand{\down}[1]{\raisebox{-0.0mm}{{\scriptsize #1}}}

\makeatletter
\newcommand{\figcaption}[1]{\def\@captype{figure}\caption{#1}}
\newcommand{\tblcaption}[1]{\def\@captype{table}\caption{#1}}
\makeatother


\title{機械学習を用いた変形ARマーカの位置姿勢推定}
\prof{山内 悠嗣}
\name{ER17076 安井理}

\begin{document}
\maketitle

%-------------------------------------------------------------------------
\sec{はじめに}
QRコードやARマーカに代表される2次元コードは，キャッシュレス決済や物品管理，広告，ロボットの認識等の分野において活用されている．
平面に貼り付けられた2次元コードを認識することで，高精度に3次元位置と姿勢を推定することができるが，2次元コードが変形すると認識に失敗する問題がある．
既に機械学習により２次元コードを検出する方法[1]が提案されているが，2次元コードの3次元姿勢を推定するまでには至っていない．

そこで，本研究では機械学習による2次元コードの検出と3次元姿勢の推定方法を提案する．
提案手法は2次元コードの検出と姿勢推定の2つの処理に分けられる．本稿では2次元コードの姿勢推定について述べる．
\sec{提案手法の概要}
本研究は，SSD による変形AR マーカの検出とAAEによる3次元姿勢推定の2つの処理に分けられる．
まず，画像からSSDによりARマーカを検出する．次に，SSDにより得られたARマーカと周辺領域の画像に対してAAEを適用することで変形を含まないARマーカーの画像を生成する．
最後に，変形を含まないARマーカとARマーカを照合することで3次元姿勢を推定する．
なお，本稿では円柱に貼り付けることにより変形したARマーカを変形ARマーカとして扱う．

\begin{figure}[ht]
\vspace{0zh}
\setlength{\epsfxsize}{7.5cm}
\centerline{\epsfbox{./eps/nagare.eps}}
\vspace{-1zh}
\caption{提案手法の概要}
\label{flow}
\vspace{-2zh}
\end{figure}

%---------------------------------------------------------------------------------------
\subsec{Augumented Autoencoder}
前段の処理により検出したARマーカの位置と大きさの情報からAugumented AutoEncoder(AAE)により姿勢を推定する．
AAEは，訓練データにノイズや変形を加えて学習し，ノイズの影響を除去した画像を生成する手法である．その過程で得られる潜在変数に基づき姿勢を推定する．

AAEの流れを図\ref{BB}に示す．
提案手法では，AAEに図\ref{BB}(b)を入力し，出力された図\ref{BB}(c)が図\ref{BB}(a)に近くなるように学習を行う．
図\ref{BB}(a)と図\ref{BB}(b)はARマーカの姿勢がペアとなるようセンサシミュレーションを用いて作成する．
AAEの学習方法は，はじめに，図\ref{BB}(b)をエンコーダーに入力し畳み込みを行い，
128次元まで圧縮された実数で表現される潜在変数$z$を得る．
次に，潜在変数をデコーダーに入力し，図\ref{BB}(c)を出力する．
デコーダから出力された図\ref{BB}(c)と図\ref{BB}(a)の損失関数を式(\ref{sonsitu})により求め，
図\ref{BB}(c)が図\ref{BB}(a)に近くなるように学習を行う．

\begin{figure}[ht]
\vspace{0zh}
\setlength{\epsfxsize}{7.5cm}
\centerline{\epsfbox{./eps/学習の流れ.eps}}
\vspace{0zh}
\caption{AAEの学習の流れ}
\label{BB}
\vspace{-3zh}
\end{figure}




\begin{eqnarray}
\label{sonsitu}
l=\frac{1}{n}\sum_{i＝１} ||x_i-x'_i||_2
\end{eqnarray}

ここで$l$は損失関数を表しており，$n$はデータ数である．
損失関数は，出力データ$x'_i$と教師データ$x_i$の平均2乗誤差を計算し求められる．




%---------------------------------------------------------------------------------
\subsec{提案手法による姿勢推定}
提案手法による姿勢推定は，事前準備となるデータベース（DB）作成，
検出されたARマーカの潜在変数の取得，
DBと検出されたARマーカの潜在変数を用いた類似度計算
の3つの処理によって行われる．

DBの作成方法は，ARマーカの姿勢をroll0$\sim$360度, pitch-35$\sim$35度, yaw-15$\sim15$度の範囲で設定し，
各角度3度刻みで回転させ合計264,124枚の画像を撮影する．
各姿勢の画像を学習済みのAAEに入力し，エンコーダーから出力された各姿勢の潜在変数をDBとして保存する．

姿勢の推定方法は，まず，検出されたARマーカ画像を学習済みのAAEに入力し，エンコーダーの出力から潜在変数を取得する．
次に，得られた潜在変数とDBに保存した潜在変数をコサイン類似度を用いて計算する．
類似度が最も高い潜在変数を持つDBの姿勢を推定姿勢として決定する．
%姿勢推定時には，検出されたARマーカ画像を学習済みのAAEに入力しエンコーダーより潜在変数を取得する．
%類似度計算は，検出されたARマーカの潜在変数とDBに保存した潜在変数をコサイン類似度を用いて計算する．
%最も近い潜在変数を持つDBの姿勢を推定姿勢として決定する．

%\begin{eqnarray}
%\vspace{-2zh}
%\label{cos}
%cos_n=\frac{\vec{z}_n \vec{z}_{test}}{||\vec{z}_n|| ||\vec{z}_{test}||}
%\end{eqnarray}



%------------------------------------------------------------------------------


\sec{評価実験}


提案手法の有効性を確認するために評価実験を行う．
変形ARマーカの姿勢推定結果を平均絶対誤差（MAE）を用いて[roll,pitch,yaw]の推定精度を評価した．
評価を行う画像はセンサシミュレーションにより	
半径20, 30, 40[mm]の変形ARマーカモデルをランダム姿勢100枚ずつ用意する．

評価結果を表\ref{hyouka}に示す．全体の結果として2～3前後の誤差が生じるという結果となった．
今回の実験ではDBの分解能を3度で行ったため，細かい姿勢までを推定できなかった．
その為，分解能を1度まで細かくすることにより推定精度が向上すると考えられる．
また，復元精度が低い姿勢が複数あることから学習データのバリエーションを増やすことで復元精度が上がり推定精度も上がると考えられる．
%３画像の復元は正確に行えていることから，データベースからの決定時に誤差が乗じていると考えられる．

%と平均絶対誤差（MAE）



\begin{table}[h]
        \vspace{0zh}
          \begin{center}
            \caption{提案手法における姿勢推定精度 MAE}
            \label{hyouka}
            \begin{tabular}{c|c|c|c|c} \hline
              円柱半径[mm]   & roll& pitch & yaw&姿勢平均 \\ \hline
              20& 4.39 & 3.06 & 2.77 &3.40\\ \hline
              30&2.76 & 2.88 & 2.58& 2.74 \\ \hline
              40&2.52 &2.65  &2.43&2.53 \\ \hline
              \end{tabular}
          \end{center}
        \vspace{-1.0zh}
\end{table}

%\begin{figure}[ht]
%\vspace{-2zh}
%\setlength{\epsfxsize}{6.5cm}
%\centerline{\epsfbox{./eps/復元.eps}}
%\vspace{-1zh}
%\caption{復元画像}
%\label
%\label{F}
%\vspace{-2zh}
%\end{figure}


%\begin{table}[h]
        %\vspace{-1.8zh}
         % \begin{center}
       %     \caption{MAE}
       %     \label{hyouka2}
     %       \begin{tabular}{l|c|c|c} \hline
   %           円柱半径[mm]   & roll& pitch & yaw \\ \hline
 %20  & 2.43° & 2.2° & 2.5° \\ \hline
         %     30  & 0° & 1° & 2.2° \\ \hline
       %       40  & 1° & 1° & 1° \\ \hline
     %         50  & 0°& 2° & 1° \\ \hline
   %           \end{tabular}
 %         \end{center}
 %       \vspace{-1.0zh}
%\end{table}





\sec{おわりに}
本研究では，変形ARマーカの認識及び姿勢推定を提案し，機械学習によってARマーカの座標位置，姿勢を推定できる事を確認した．今後は，提案手法による実環境下での姿勢推定を研究予定である．

\markboth{参考文献}{}     %% BibTeX を使う
%\bibliographystyle{jalpha}
%\newcommand{\noop}[1]{}
%\bibliographystyle{jabbrv}
%\bibliography{ref}

\begin{thebibliography}{1}
%{\scriptsize 
%\bibitem{hog+motion}
%Wei Liu，Dragomir Anguelov， Dumitru Erhan，Christian Szegedy，Scott Reed，Cheng-Yang Fu， Alexander C. Berg : ``SSD: Single Shot MultiBox Detector'', Proc. of ECCV, 2016.}

{\scriptsize
\bibitem{fasterrcnn}
鈴木舞香，山内悠嗣: "機械学習による変形ARマーカの認識", 中部大学工学部ロボット理工学科卒業論文発表， 2020． }

{\scriptsize
\bibitem{hog+motion}
W．Liu {\em et al. }: "SSD: Single Shot MultiBox Detector",Proc. of ECCV,2016.}

{\scriptsize 
\bibitem{pixel}
Martin Sundermeyer {\em et al．}:"Implicit 3D Orientation Learning for 6D Object Detection from RGB Images'',Proc. of ECCV， 2016．}

\end{thebibliography}
\end{document}