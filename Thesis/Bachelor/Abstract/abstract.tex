\documentclass{jsarticle}
\usepackage{abst, epsf,graphicx, tabularx, ascmac}
%\usepackage{comment}

\newcommand{\bd}[1]{\mbox{\boldmath$#1$}}
\newcommand{\mysubsec}[1]{\noindent {\bf #1} \ \ }
\newcommand{\down}[1]{\raisebox{-0.0mm}{{\scriptsize #1}}}

\makeatletter
\newcommand{\figcaption}[1]{\def\@captype{figure}\caption{#1}}
\newcommand{\tblcaption}[1]{\def\@captype{table}\caption{#1}}
\makeatother


\title{機械学習を用いた変形ARマーカの位置姿勢推定}
\prof{山内 悠嗣}
\name{ER17076 安井理}

\begin{document}
\maketitle

%-------------------------------------------------------------------------
\sec{はじめに}
近年，2 次元コードは，キャッシュレス決済や物品管理，
広告，ロボットの認識等の分野など様々な場面で活用されて
いる．しかし，２次元コードは平面に張ることを前提として
いるため，既存の手法では変形した2 次元コードを認識す
ることができない問題がある．既に機械学習により２次元
コードを検出する方法[1] が提案されているが，2 次元コー
ドの3 次元姿勢を推定するまでには至っていない．
そこで，本研究では機械学習による２次元コードの検出と
姿勢の推定方法を提案する．提案手法は2 次元コードの検
出と姿勢推定の2 つの処理に分けられる．本稿では2 次元
コードの姿勢推定について述べる．


\sec{提案手法の概要}
本研究は，SSDによる変形ARマーカの検出とAAEによる3次元姿勢推定の2つの処理に分けられる．
まず，画像からSSDによりARマーカを検出する．
次に，SSDにより得られたARマーカと周辺領域の画像に対してAAEを適用することで変形を含まないARマーカーの画像を生成する．
最後に，変形を含まないARマーカとARマーカDBを照合することで3次元姿勢を推定する．
\begin{figure}[ht]
\vspace{0zh}
\setlength{\epsfxsize}{7.5cm}
\centerline{\epsfbox{./eps/nagare.eps}}
\vspace{-1zh}
\caption{提案手法の概要}
\label{flow}
\vspace{-2zh}
\end{figure}

%---------------------------------------------------------------------------------------
\subsec{Augumented Autoencoder}
SSDにより求めた変形したARマーカをAugumented Autoeoncoder(AAE)により変形のないマーカに変換する．
AAEは，訓練データに背景画像や光，遮蔽物など環境ノイズを加え学習を行いノイズによらない訓練データの本質的な潜在表現を学習するオートエンコーダーである．

AAEの学習の流れを図\ref{BB}に示す．
提案手法では，変形ARマーカに背景テクスチャを付けた画像を訓練データ図\ref{BB}(b)，
訓練データに姿勢が対応する平面状のARマーカ画像を教師データ図\ref{BB}(a)とした教師あり学習を行う．
また，学習用画像はセンサシミュレーションにより生成し収集を行う．

訓練データをエンコーダーに入力し，圧縮されたデータの１次元特徴（潜在変数$z$）
を得る．
潜在変数$z$をデコーダーに入力し，復元データ図\ref{BB}(c)を出力する．
復元データと教師データの損失関数を式(\ref{sonsitu})により求め，２つのデータの損失が
小さくなるように学習を行う．


\begin{figure}[ht]
\vspace{0zh}
\setlength{\epsfxsize}{7.5cm}
\centerline{\epsfbox{./eps/学習の流れ.eps}}
\vspace{0zh}
\caption{AAEの学習の流れ}
\label{BB}
\vspace{-1zh}
\end{figure}




\begin{eqnarray}
\label{sonsitu}
l=\frac{1}{n}\sum_{i＝１} ||x_i-x'_i||_2
\end{eqnarray}

ここで$l$は損失関数を表しており，$n$はデータ数である．
損失関数は，復元データ$x'_i$と教師データ$x_i$の平均２乗誤差を計算し求められる．








%---------------------------------------------------------------------------------
\subsec{提案手法による姿勢推定}
学習済みのエンコーダーによって得られる１次元に圧縮された128個の実数によって表現される潜在変数$z$を用いて類似度計算をし，姿勢推定を行う．


姿勢推定は，推定対象となる変形ARマーカ画像をエンコーダーに入力し，出力される潜在変数$z_{test}$とデータベース（DB）に保存した潜在変数$z_n$のコサイン類似度を式(2)により計算する．そして，最も近い潜在変数の姿勢情報を物体姿勢として決定する．

DBは，ARマーカの姿勢をrollを0$\sim$360度, pitchを-35$\sim$35度, yawを-15$\sim15$度と範囲を設定し，各角度3度刻みで回転させ792,360枚の画像を撮影する．その後，エンコーダーに入力し，出力された潜在変数$z_n$（$z_n$は$z$集合の１つ）を分解能3度のDBとして保存する．


%\footnotesize{
\begin{eqnarray}
\vspace{-2zh}
\label{cos}
cos_n=\frac{\vec{z}_n \vec{z}_{test}}{||\vec{z}_n|| ||\vec{z}_{test}||}
%=\frac{x_1x'_1+\cdots+x_n x'_n}{\sqrt{x^2_1+\cdots+x'^2_n}\sqrt{x^2_1+\cdots+x'^2_n}}
\end{eqnarray}



%------------------------------------------------------------------------------


\sec{評価実験}


提案手法の有効性を確認するために評価実験を行う．
変形ARマーカの姿勢推定結果を平均絶対誤差（MAE）を用いて推定精度の評価を行った．
評価を行う画像はセンサシミュレーションにより変形ARマーカを撮影し，背景テクスチャを付けた画像を使用した．
半径20, 30, 40[mm]の変形ARマーカモデルをランダム姿勢100枚ずつ用意する．
提案手法により推定された姿勢と正解姿勢の[roll,pitch,yaw]のMAEを求める．

評価結果を表\ref{hyouka}に示す．各半径の小さい円柱ほど精度は高くなり，全体としては4～5前後の誤差が生じるという結果となった．円柱半径が小さいほど姿勢によって画像特徴量が大きく変わり，潜在変数が明確になることから精度が高くなったと考えられる．またDBの分解能を3度で行ったため分解能を1度まで細かくすることにより推定精度が向上すると考えられる．
%３画像の復元は正確に行えていることから，データベースからの決定時に誤差が乗じていると考えられる．

%と平均絶対誤差（MAE）



\begin{table}[h]
        \vspace{0zh}
          \begin{center}
            \caption{提案手法における姿勢推定精度 MAE}
            \label{hyouka}
            \begin{tabular}{c|c|c|c|c} \hline
              円柱半径[mm]   & roll& pitch & yaw&姿勢平均 \\ \hline
              20& 5.30 & 3.64 & 3.42 &4.12\\ \hline
              30&5.78 & 4.49 & 3.71& 4.66 \\ \hline
              40&6.52 &4.51  &3.73&4.91 \\ \hline
              \end{tabular}
          \end{center}
        \vspace{-1.0zh}
\end{table}

%\begin{figure}[ht]
%\vspace{-2zh}
%\setlength{\epsfxsize}{6.5cm}
%\centerline{\epsfbox{./eps/復元.eps}}
%\vspace{-1zh}
%\caption{復元画像}
%\label
%\label{F}
%\vspace{-2zh}
%\end{figure}


%\begin{table}[h]
        %\vspace{-1.8zh}
         % \begin{center}
       %     \caption{MAE}
       %     \label{hyouka2}
     %       \begin{tabular}{l|c|c|c} \hline
   %           円柱半径[mm]   & roll& pitch & yaw \\ \hline
 %20  & 2.43° & 2.2° & 2.5° \\ \hline
         %     30  & 0° & 1° & 2.2° \\ \hline
       %       40  & 1° & 1° & 1° \\ \hline
     %         50  & 0°& 2° & 1° \\ \hline
   %           \end{tabular}
 %         \end{center}
 %       \vspace{-1.0zh}
%\end{table}





\sec{おわりに}
本研究では，変形ARマーカの認識及び姿勢推定を提案し，機械学習によってARマーカの座標位置，姿勢を推定できる事を確認した．今後は，提案手法による実環境下での姿勢推定を研究予定である．

\markboth{参考文献}{}     %% BibTeX を使う
%\bibliographystyle{jalpha}
%\newcommand{\noop}[1]{}
%\bibliographystyle{jabbrv}
%\bibliography{ref}

\begin{thebibliography}{1}
%{\scriptsize 
%\bibitem{hog+motion}
%Wei Liu，Dragomir Anguelov， Dumitru Erhan，Christian Szegedy，Scott Reed，Cheng-Yang Fu， Alexander C. Berg : ``SSD: Single Shot MultiBox Detector'', Proc. of ECCV, 2016.}

{\scriptsize
\bibitem{fasterrcnn}
鈴木舞香，山内悠嗣: "機械学習による変形ARマーカの認識", 中部大学工学部ロボット理工学科卒業論文発表， 2020． }

{\scriptsize
\bibitem{hog+motion}
W．Liu {\em et al. }: "SSD: Single Shot MultiBox Detector",Proc. of ECCV,2016.}

{\scriptsize 
\bibitem{pixel}
Martin Sundermeyer {\em et al．}:"Implicit 3D Orientation Learning for 6D Object Detection from RGB Images'',Proc. of ECCV， 2016．}

\end{thebibliography}
\end{document}